# ä»£ç†ç³»ç»Ÿé›†æˆæµ‹è¯•

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**   
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py)
- [browser_manager.py](file://vibe_surf/browser/browser_manager.py)
- [browser_use_agent.py](file://vibe_surf/agents/browser_use_agent.py)
- [shared_state.py](file://vibe_surf/backend/shared_state.py)
- [test_agents.py](file://tests/test_agents.py)
- [test_browser.py](file://tests/test_browser.py)
- [browser_use_tools.py](file://vibe_surf/tools/browser_use_tools.py)
- [vibesurf_tools.py](file://vibe_surf/tools/vibesurf_tools.py)
- [views.py](file://vibe_surf/agents/views.py)
</cite>

## ç›®å½•
1. [å¼•è¨€](#å¼•è¨€)
2. [ä»£ç†ç³»ç»Ÿæ¶æ„](#ä»£ç†ç³»ç»Ÿæ¶æ„)
3. [æ ¸å¿ƒç»„ä»¶åˆ†æ](#æ ¸å¿ƒç»„ä»¶åˆ†æ)
4. [é›†æˆæµ‹è¯•ç­–ç•¥](#é›†æˆæµ‹è¯•ç­–ç•¥)
5. [å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œæµ‹è¯•](#å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œæµ‹è¯•)
6. [ä»»åŠ¡è°ƒåº¦æµ‹è¯•](#ä»»åŠ¡è°ƒåº¦æµ‹è¯•)
7. [æµè§ˆå™¨æ“ä½œæµ‹è¯•](#æµè§ˆå™¨æ“ä½œæµ‹è¯•)
8. [çŠ¶æ€ç®¡ç†æµ‹è¯•](#çŠ¶æ€ç®¡ç†æµ‹è¯•)
9. [LLMäº¤äº’æµ‹è¯•](#llmäº¤äº’æµ‹è¯•)
10. [å¼‚å¸¸å¤„ç†æµ‹è¯•](#å¼‚å¸¸å¤„ç†æµ‹è¯•)
11. [æ€§èƒ½æµ‹è¯•](#æ€§èƒ½æµ‹è¯•)
12. [ç»“è®º](#ç»“è®º)

## å¼•è¨€
æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†VibeSurfä¸­AIä»£ç†ä¸æµè§ˆå™¨è‡ªåŠ¨åŒ–åŠŸèƒ½çš„é›†æˆæµ‹è¯•æ–¹æ³•ã€‚é‡ç‚¹é˜è¿°äº†vibe_surf_agentä¸browser_managerçš„ååŒå·¥ä½œéªŒè¯ï¼ŒåŒ…æ‹¬å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œå’Œä»»åŠ¡è°ƒåº¦çš„æµ‹è¯•ç­–ç•¥ã€‚æ–‡æ¡£è¿˜è¯¦ç»†è¯´æ˜äº†browser_use_agentåœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œæ“ä½œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œå¦‚é¡µé¢å¯¼èˆªã€å…ƒç´ äº¤äº’å’Œå†…å®¹æå–ã€‚é€šè¿‡pytestæ¡†æ¶æä¾›äº†æµ‹è¯•ä»£ç†çŠ¶æ€ç®¡ç†å’Œå…±äº«çŠ¶æ€(shared_state)çš„ç¤ºä¾‹ä»£ç ï¼Œå¹¶è§£é‡Šäº†å¦‚ä½•æµ‹è¯•ä»£ç†åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸LLMæœåŠ¡çš„äº¤äº’ï¼ŒåŒ…æ‹¬æç¤ºè¯ç”Ÿæˆå’Œå“åº”å¤„ç†ã€‚æ­¤å¤–ï¼Œæ–‡æ¡£è¿˜æ¶µç›–äº†å¼‚å¸¸å¤„ç†æœºåˆ¶çš„æµ‹è¯•æ–¹æ³•å’Œæ€§èƒ½æµ‹è¯•ç­–ç•¥ã€‚

## ä»£ç†ç³»ç»Ÿæ¶æ„
VibeSurfçš„ä»£ç†ç³»ç»Ÿé‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Œæ ¸å¿ƒç»„ä»¶åŒ…æ‹¬vibe_surf_agentã€browser_managerå’Œbrowser_use_agentã€‚vibe_surf_agentä½œä¸ºä¸»ä»£ç†ï¼Œè´Ÿè´£åè°ƒä»»åŠ¡æ‰§è¡Œå’Œå†³ç­–ï¼Œé€šè¿‡LangGraphå·¥ä½œæµç®¡ç†æ•´ä¸ªæ‰§è¡Œæµç¨‹ã€‚browser_managerè´Ÿè´£ç®¡ç†å¤šä¸ªæµè§ˆå™¨ä¼šè¯ï¼Œä¸ºä¸åŒä»£ç†æä¾›éš”ç¦»çš„æµè§ˆå™¨ç¯å¢ƒã€‚browser_use_agentæ˜¯ä¸“é—¨ç”¨äºæµè§ˆå™¨æ“ä½œçš„å­ä»£ç†ï¼Œèƒ½å¤Ÿæ‰§è¡Œå…·ä½“çš„ç½‘é¡µäº¤äº’ä»»åŠ¡ã€‚è¿™äº›ç»„ä»¶é€šè¿‡å…±äº«çŠ¶æ€(shared_state)è¿›è¡Œé€šä¿¡å’Œåè°ƒï¼Œç¡®ä¿äº†ç³»ç»Ÿçš„æ•´ä½“ä¸€è‡´æ€§å’Œå¯æ‰©å±•æ€§ã€‚

```mermaid
graph TD
A[vibe_surf_agent] --> B[browser_manager]
B --> C[browser_use_agent]
A --> D[shared_state]
B --> D
C --> D
D --> E[LLMæœåŠ¡]
D --> F[æ–‡ä»¶ç³»ç»Ÿ]
D --> G[æ•°æ®åº“]
```

**Diagram sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py)
- [browser_manager.py](file://vibe_surf/browser/browser_manager.py)
- [browser_use_agent.py](file://vibe_surf/agents/browser_use_agent.py)
- [shared_state.py](file://vibe_surf/backend/shared_state.py)

## æ ¸å¿ƒç»„ä»¶åˆ†æ
### vibe_surf_agentåˆ†æ
vibe_surf_agentæ˜¯VibeSurfç³»ç»Ÿçš„æ ¸å¿ƒåè°ƒè€…ï¼Œè´Ÿè´£ç®¡ç†æ•´ä¸ªä»»åŠ¡æ‰§è¡Œæµç¨‹ã€‚å®ƒä½¿ç”¨LangGraphæ¡†æ¶æ„å»ºå·¥ä½œæµï¼Œé€šè¿‡VibeSurfStateç±»ç»´æŠ¤æ‰§è¡ŒçŠ¶æ€ã€‚è¯¥ä»£ç†èƒ½å¤Ÿæ ¹æ®ä»»åŠ¡éœ€æ±‚å†³å®šæ˜¯å¦è°ƒç”¨browser_use_agentæ‰§è¡Œæµè§ˆå™¨ä»»åŠ¡ï¼Œæˆ–ç›´æ¥ç”Ÿæˆæœ€ç»ˆå“åº”ã€‚å…¶å…³é”®ç‰¹æ€§åŒ…æ‹¬æ§åˆ¶çŠ¶æ€ç®¡ç†ï¼ˆæš‚åœã€åœæ­¢ï¼‰ã€ä»»åŠ¡è·¯ç”±å’Œç»“æœèšåˆã€‚

**Section sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py)

### browser_manageråˆ†æ
browser_managerè´Ÿè´£ç®¡ç†å¤šä¸ªæµè§ˆå™¨ä¼šè¯ï¼Œä¸ºä¸åŒä»£ç†æä¾›éš”ç¦»çš„æµè§ˆå™¨ç¯å¢ƒã€‚å®ƒé€šè¿‡register_agentå’Œunregister_agentæ–¹æ³•ç®¡ç†ä»£ç†çš„ç”Ÿå‘½å‘¨æœŸï¼Œç¡®ä¿æ¯ä¸ªä»£ç†éƒ½æœ‰ç‹¬ç«‹çš„CDPï¼ˆChrome DevTools Protocolï¼‰ä¼šè¯ã€‚è¯¥ç»„ä»¶è¿˜æä¾›äº†get_activate_tabå’Œget_all_tabsç­‰æ–¹æ³•ï¼Œç”¨äºè·å–å½“å‰æµè§ˆå™¨çŠ¶æ€ã€‚

**Section sources**
- [browser_manager.py](file://vibe_surf/browser/browser_manager.py)

### browser_use_agentåˆ†æ
browser_use_agentæ˜¯ä¸“é—¨ç”¨äºæµè§ˆå™¨æ“ä½œçš„å­ä»£ç†ï¼Œèƒ½å¤Ÿæ‰§è¡Œå…·ä½“çš„ç½‘é¡µäº¤äº’ä»»åŠ¡ã€‚å®ƒç»§æ‰¿è‡ªbrowser_useçš„Agentç±»ï¼Œå…·æœ‰å®Œæ•´çš„æµè§ˆå™¨æ“ä½œèƒ½åŠ›ï¼ŒåŒ…æ‹¬é¡µé¢å¯¼èˆªã€å…ƒç´ äº¤äº’ã€å†…å®¹æå–ç­‰ã€‚è¯¥ä»£ç†é€šè¿‡step_callbackæœºåˆ¶ä¸ä¸»ä»£ç†é€šä¿¡ï¼ŒæŠ¥å‘Šæ¯ä¸ªæ‰§è¡Œæ­¥éª¤çš„è¯¦ç»†ä¿¡æ¯ã€‚

**Section sources**
- [browser_use_agent.py](file://vibe_surf/agents/browser_use_agent.py)

## é›†æˆæµ‹è¯•ç­–ç•¥
VibeSurfçš„é›†æˆæµ‹è¯•é‡‡ç”¨pytestæ¡†æ¶ï¼Œé€šè¿‡æ¨¡æ‹ŸçœŸå®ä½¿ç”¨åœºæ™¯æ¥éªŒè¯ç³»ç»ŸåŠŸèƒ½ã€‚æµ‹è¯•ç­–ç•¥åŒ…æ‹¬å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œç«¯åˆ°ç«¯æµ‹è¯•ä¸‰ä¸ªå±‚æ¬¡ã€‚å•å…ƒæµ‹è¯•éªŒè¯å•ä¸ªç»„ä»¶çš„åŠŸèƒ½ï¼Œé›†æˆæµ‹è¯•éªŒè¯ç»„ä»¶é—´çš„ååŒå·¥ä½œï¼Œç«¯åˆ°ç«¯æµ‹è¯•éªŒè¯æ•´ä¸ªç³»ç»Ÿçš„å·¥ä½œæµç¨‹ã€‚æµ‹è¯•ç”¨ä¾‹è¦†ç›–äº†æ­£å¸¸æµç¨‹ã€å¼‚å¸¸å¤„ç†å’Œè¾¹ç•Œæ¡ä»¶ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§ã€‚

```mermaid
flowchart TD
A[æµ‹è¯•ç­–ç•¥] --> B[å•å…ƒæµ‹è¯•]
A --> C[é›†æˆæµ‹è¯•]
A --> D[ç«¯åˆ°ç«¯æµ‹è¯•]
B --> E[éªŒè¯å•ä¸ªç»„ä»¶]
C --> F[éªŒè¯ç»„ä»¶ååŒ]
D --> G[éªŒè¯å®Œæ•´æµç¨‹]
```

**Diagram sources**
- [test_agents.py](file://tests/test_agents.py)
- [test_browser.py](file://tests/test_browser.py)

## å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œæµ‹è¯•
å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œæ˜¯VibeSurfçš„æ ¸å¿ƒåŠŸèƒ½ä¹‹ä¸€ï¼Œé€šè¿‡execute_parallel_browser_tasksæ–¹æ³•å®ç°ã€‚è¯¥æ–¹æ³•èƒ½å¤ŸåŒæ—¶ä¸ºå¤šä¸ªä»»åŠ¡åˆ›å»ºç‹¬ç«‹çš„æµè§ˆå™¨ä»£ç†ï¼Œå®ç°çœŸæ­£çš„å¹¶è¡Œæ‰§è¡Œã€‚æµ‹è¯•ç”¨ä¾‹éªŒè¯äº†ä»¥ä¸‹å…³é”®åŠŸèƒ½ï¼š
- å¹¶è¡Œä»»åŠ¡çš„æ­£ç¡®åˆ›å»ºå’Œæ³¨å†Œ
- å„ä»»åŠ¡é—´çš„éš”ç¦»æ€§ï¼Œç¡®ä¿ä¸€ä¸ªä»»åŠ¡çš„å¤±è´¥ä¸ä¼šå½±å“å…¶ä»–ä»»åŠ¡
- èµ„æºçš„æœ‰æ•ˆç®¡ç†å’Œå›æ”¶
- æ‰§è¡Œç»“æœçš„æ­£ç¡®èšåˆ

```python
# æµ‹è¯•å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œ
async def test_multi_bu_agents():
    # åˆ›å»ºå¤šä¸ªæµè§ˆå™¨ä»£ç†
    agent_browser_sessions = await asyncio.gather(
        browser_manager.register_agent("agent-1"),
        browser_manager.register_agent("agent-2"),
        browser_manager.register_agent("agent-3")
    )
    # åˆ›å»ºå¤šä¸ªbrowser_use_agentå®ä¾‹
    agents = [
        BrowserUseAgent(task=task, llm=llm, browser_session=agent_browser_sessions[i])
        for i, task in enumerate([
            'search browser-use and click into the most relevant url',
            'search langflow and click into the most relevant url',
            'search langgraph and click into the most relevant url',
        ])
    ]
    # å¹¶è¡Œæ‰§è¡Œæ‰€æœ‰ä»£ç†
    results = await asyncio.gather(*[agent.run() for agent in agents])
```

**Section sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L607-L763)
- [test_agents.py](file://tests/test_agents.py#L78-L148)

## ä»»åŠ¡è°ƒåº¦æµ‹è¯•
ä»»åŠ¡è°ƒåº¦æµ‹è¯•éªŒè¯äº†vibe_surf_agentå¦‚ä½•æ ¹æ®ä»»åŠ¡éœ€æ±‚åŠ¨æ€è°ƒåº¦å­ä»£ç†ã€‚æµ‹è¯•ç”¨ä¾‹åŒ…æ‹¬ï¼š
- ä»»åŠ¡è·¯ç”±çš„æ­£ç¡®æ€§ï¼šéªŒè¯ä»£ç†èƒ½å¦æ­£ç¡®è¯†åˆ«éœ€è¦æµè§ˆå™¨æ“ä½œçš„ä»»åŠ¡å¹¶è·¯ç”±åˆ°browser_use_agent
- ä»»åŠ¡å‚æ•°çš„æ­£ç¡®ä¼ é€’ï¼šéªŒè¯ä»»åŠ¡æè¿°ã€æ–‡ä»¶åˆ—è¡¨ç­‰å‚æ•°èƒ½å¦æ­£ç¡®ä¼ é€’ç»™å­ä»£ç†
- æ‰§è¡Œç»“æœçš„æ­£ç¡®å¤„ç†ï¼šéªŒè¯å­ä»£ç†çš„æ‰§è¡Œç»“æœèƒ½å¦è¢«æ­£ç¡®æ”¶é›†å’Œå¤„ç†

```python
# ä»»åŠ¡è°ƒåº¦æµ‹è¯•
async def _vibesurf_agent_node_impl(state: VibeSurfState) -> VibeSurfState:
    # æ£€æŸ¥æ˜¯å¦éœ€è¦æ‰§è¡Œæµè§ˆå™¨ä»»åŠ¡
    if action_name == 'execute_browser_use_agent':
        # è·¯ç”±åˆ°æµè§ˆå™¨ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹
        params = action_data[action_name]
        state.browser_tasks = params.get('tasks', [])
        state.current_action = 'execute_browser_use_agent'
        state.action_params = params
        state.current_step = "browser_task_execution"
        return state
```

**Section sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L435-L454)

## æµè§ˆå™¨æ“ä½œæµ‹è¯•
æµè§ˆå™¨æ“ä½œæµ‹è¯•éªŒè¯äº†browser_use_agentåœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œå„ç§æ“ä½œçš„èƒ½åŠ›ã€‚æµ‹è¯•ç”¨ä¾‹è¦†ç›–äº†ä»¥ä¸‹æ“ä½œï¼š
- é¡µé¢å¯¼èˆªï¼šéªŒè¯ä»£ç†èƒ½å¦æ­£ç¡®å¯¼èˆªåˆ°æŒ‡å®šURL
- å…ƒç´ äº¤äº’ï¼šéªŒè¯ä»£ç†èƒ½å¦æ­£ç¡®ç‚¹å‡»ã€è¾“å…¥æ–‡æœ¬ã€é€‰æ‹©ä¸‹æ‹‰é€‰é¡¹ç­‰
- å†…å®¹æå–ï¼šéªŒè¯ä»£ç†èƒ½å¦æ­£ç¡®æå–ç½‘é¡µå†…å®¹
- å±å¹•æˆªå›¾ï¼šéªŒè¯ä»£ç†èƒ½å¦æ­£ç¡®æˆªå–å±å¹•å¹¶ä¿å­˜

```python
# æµè§ˆå™¨æ“ä½œæµ‹è¯•
async def test_browser_state_capture(manager: BrowserManager):
    # æ³¨å†Œå¤šä¸ªä»£ç†
    agent1, agent2, agent3 = await asyncio.gather(
        manager.register_agent("agent-state-1"),
        manager.register_agent("agent-state-2"),
        manager.register_agent("agent-state-3")
    )
    # å¹¶è¡Œå¯¼èˆªåˆ°ä¸åŒé¡µé¢
    await asyncio.gather(
        agent1.navigate_to_url("https://www.python.org"),
        agent2.navigate_to_url("https://www.rust-lang.org"),
        agent3.navigate_to_url("https://www.github.com"),
    )
    # å¹¶è¡Œæˆªå–å±å¹•
    screenshot1, screenshot2, screenshot3 = await asyncio.gather(
        agent1.take_screenshot(),
        agent2.take_screenshot(),
        agent3.take_screenshot(),
    )
```

**Section sources**
- [test_browser.py](file://tests/test_browser.py#L84-L210)

## çŠ¶æ€ç®¡ç†æµ‹è¯•
çŠ¶æ€ç®¡ç†æµ‹è¯•éªŒè¯äº†ä»£ç†ç³»ç»Ÿå¦‚ä½•ç®¡ç†å…±äº«çŠ¶æ€(shared_state)å’Œæ‰§è¡ŒçŠ¶æ€ã€‚æµ‹è¯•ç”¨ä¾‹åŒ…æ‹¬ï¼š
- å…±äº«çŠ¶æ€çš„æ­£ç¡®åˆå§‹åŒ–å’Œæ›´æ–°
- ä»£ç†çŠ¶æ€çš„æ­£ç¡®è·Ÿè¸ªå’ŒæŠ¥å‘Š
- æ§åˆ¶çŠ¶æ€ï¼ˆæš‚åœã€åœæ­¢ï¼‰çš„æ­£ç¡®å¤„ç†

```python
# ä½¿ç”¨pytestæµ‹è¯•ä»£ç†çŠ¶æ€ç®¡ç†
def test_vibe_surf_agent_control():
    # æµ‹è¯•ä»£ç†æ§åˆ¶åŠŸèƒ½ï¼ˆæš‚åœ/æ¢å¤/åœæ­¢ï¼‰
    print("ğŸ§ª Testing VibeSurfAgent control functionality...")
    
    # æµ‹è¯•1: æ£€æŸ¥ç©ºé—²æ—¶çš„çŠ¶æ€
    print("ğŸ“Š Testing initial status...")
    status = agent.get_status()
    print(f"Initial status: {status.overall_status}")
    assert status.overall_status == "idle"
    
    # æµ‹è¯•2: å¼€å§‹é•¿æ—¶é—´è¿è¡Œçš„æµè§ˆå™¨ä»»åŠ¡
    print("ğŸš€ Starting long-running browser task...")
    browser_task = "Search for Dify, n8n, langflow and gather relative information"
    
    # åœ¨åå°å¯åŠ¨ä»»åŠ¡
    async def run_task():
        return await agent.run(browser_task)
    
    task_coroutine = asyncio.create_task(run_task())
    
    # ç­‰å¾…ä»»åŠ¡å¼€å§‹
    await asyncio.sleep(10)
    
    # æµ‹è¯•3: æ£€æŸ¥æ‰§è¡ŒæœŸé—´çš„çŠ¶æ€
    print("ğŸ“Š Checking status during execution...")
    status = agent.get_status()
    print(f"Running status: {status.overall_status}")
    assert status.overall_status == "running"
    
    # æµ‹è¯•4: æš‚åœæ‰§è¡Œ
    print("â¸ï¸ Testing pause functionality...")
    pause_result = await agent.pause("Testing pause functionality")
    print(f"Pause result: {pause_result.success} - {pause_result.message}")
    assert pause_result.success
    
    # æ£€æŸ¥æš‚åœåçš„çŠ¶æ€
    await asyncio.sleep(1)
    status = agent.get_status()
    print(f"Paused status: {status.overall_status}")
    assert status.overall_status == "paused"
```

**Section sources**
- [shared_state.py](file://vibe_surf/backend/shared_state.py)
- [test_agents.py](file://tests/test_agents.py#L230-L375)

## LLMäº¤äº’æµ‹è¯•
LLMäº¤äº’æµ‹è¯•éªŒè¯äº†ä»£ç†ç³»ç»Ÿå¦‚ä½•ä¸LLMæœåŠ¡è¿›è¡Œäº¤äº’ï¼ŒåŒ…æ‹¬æç¤ºè¯ç”Ÿæˆå’Œå“åº”å¤„ç†ã€‚æµ‹è¯•ç”¨ä¾‹åŒ…æ‹¬ï¼š
- æç¤ºè¯çš„æ­£ç¡®ç”Ÿæˆå’Œæ ¼å¼åŒ–
- LLMå“åº”çš„æ­£ç¡®è§£æå’Œå¤„ç†
- äº¤äº’å†å²çš„æ­£ç¡®ç»´æŠ¤

```python
# LLMäº¤äº’æµ‹è¯•
async def _vibesurf_agent_node_impl(state: VibeSurfState) -> VibeSurfState:
    # è·å–LLMå“åº”
    response = await vibesurf_agent.llm.ainvoke(vibesurf_agent.message_history, output_format=AgentOutput)
    parsed = response.completion
    action = parsed.action
    
    # å°†LLMå“åº”æ·»åŠ åˆ°æ¶ˆæ¯å†å²
    vibesurf_agent.message_history.append(
        AssistantMessage(content=json.dumps(response.completion.model_dump(exclude_none=True, exclude_unset=True),
                                    ensure_ascii=False)))
    
    # å¤„ç†LLMåŠ¨ä½œ
    if action_name == 'execute_browser_use_agent':
        # è·¯ç”±åˆ°æµè§ˆå™¨ä»»åŠ¡æ‰§è¡ŒèŠ‚ç‚¹
        params = action_data[action_name]
        state.browser_tasks = params.get('tasks', [])
        state.current_action = 'execute_browser_use_agent'
        state.action_params = params
        state.current_step = "browser_task_execution"
        return state
```

**Section sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L402-L442)

## å¼‚å¸¸å¤„ç†æµ‹è¯•
å¼‚å¸¸å¤„ç†æµ‹è¯•éªŒè¯äº†ä»£ç†ç³»ç»Ÿåœ¨å„ç§å¼‚å¸¸æƒ…å†µä¸‹çš„è¡Œä¸ºï¼ŒåŒ…æ‹¬ç½‘ç»œä¸­æ–­ã€é¡µé¢åŠ è½½å¤±è´¥ç­‰ã€‚æµ‹è¯•ç”¨ä¾‹åŒ…æ‹¬ï¼š
- ç½‘ç»œè¿æ¥å¤±è´¥çš„å¤„ç†
- é¡µé¢åŠ è½½è¶…æ—¶çš„å¤„ç†
- å…ƒç´ å®šä½å¤±è´¥çš„å¤„ç†
- LLMæœåŠ¡ä¸å¯ç”¨çš„å¤„ç†

```python
# å¼‚å¸¸å¤„ç†æµ‹è¯•
async def _vibesurf_agent_node_impl(state: VibeSurfState) -> VibeSurfState):
    try:
        # è·å–LLMå“åº”
        response = await vibesurf_agent.llm.ainvoke(vibesurf_agent.message_history, output_format=AgentOutput)
        parsed = response.completion
        action = parsed.action
        
        # å¤„ç†LLMåŠ¨ä½œ
        result = await vibesurf_agent.tools.act(
            action=action,
            browser_manager=vibesurf_agent.browser_manager,
            llm=vibesurf_agent.llm,
            file_system=vibesurf_agent.file_system,
        )
        
        if result.error:
            # å¤„ç†é”™è¯¯
            vibesurf_agent.message_history.append(UserMessage(content=f'Action error:\n{result.error}'))
            await log_agent_activity(state, agent_name, "error", result.error)
            
    except Exception as e:
        # æ•è·å¹¶å¤„ç†å¼‚å¸¸
        import traceback
        traceback_str = traceback.format_exc()
        logger.error(f"âŒ VibeSurf agent failed: {e}")
        
        # æ•è·å¼‚å¸¸é¥æµ‹
        exception_event = VibeSurfAgentExceptionEvent(
            version=vibe_surf.__version__,
            error_message=str(e)[:500],
            error_type=type(e).__name__,
            traceback=traceback_str[:1000],
            model=getattr(vibesurf_agent.llm, 'model_name', None),
            session_id=state.session_id,
            function_name='_vibesurf_agent_node_impl'
        )
        vibesurf_agent.telemetry.capture(exception_event)
        vibesurf_agent.telemetry.flush()
        
        state.final_response = f"Task execution failed: {str(e)}"
        state.is_complete = True
        await log_agent_activity(state, agent_name, "error", f"Agent failed: {str(e)}")
        return state
```

**Section sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L522-L545)

## æ€§èƒ½æµ‹è¯•
æ€§èƒ½æµ‹è¯•è¯„ä¼°äº†ä»£ç†ç³»ç»Ÿçš„æ‰§è¡Œæ•ˆç‡å’Œèµ„æºæ¶ˆè€—ã€‚æµ‹è¯•æ–¹æ³•åŒ…æ‹¬ï¼š
- æ‰§è¡Œæ—¶é—´æµ‹é‡ï¼šè®°å½•ä»»åŠ¡æ‰§è¡Œçš„æ€»æ—¶é—´å’Œå„é˜¶æ®µè€—æ—¶
- èµ„æºæ¶ˆè€—ç›‘æ§ï¼šç›‘æ§CPUã€å†…å­˜å’Œç½‘ç»œä½¿ç”¨æƒ…å†µ
- å¹¶å‘æ€§èƒ½æµ‹è¯•ï¼šæµ‹è¯•ç³»ç»Ÿåœ¨é«˜å¹¶å‘æƒ…å†µä¸‹çš„è¡¨ç°

```mermaid
flowchart TD
A[æ€§èƒ½æµ‹è¯•] --> B[æ‰§è¡Œæ—¶é—´æµ‹é‡]
A --> C[èµ„æºæ¶ˆè€—ç›‘æ§]
A --> D[å¹¶å‘æ€§èƒ½æµ‹è¯•]
B --> E[æ€»æ‰§è¡Œæ—¶é—´]
B --> F[å„é˜¶æ®µè€—æ—¶]
C --> G[CPUä½¿ç”¨ç‡]
C --> H[å†…å­˜ä½¿ç”¨]
C --> I[ç½‘ç»œæµé‡]
D --> J[å¹¶å‘ä»»åŠ¡æ•°]
D --> K[å“åº”æ—¶é—´]
D --> L[é”™è¯¯ç‡]
```

**Diagram sources**
- [vibe_surf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py)
- [test_agents.py](file://tests/test_agents.py)

## ç»“è®º
æœ¬æ–‡æ¡£è¯¦ç»†æè¿°äº†VibeSurfä»£ç†ç³»ç»Ÿçš„é›†æˆæµ‹è¯•æ–¹æ³•ã€‚é€šè¿‡å…¨é¢çš„æµ‹è¯•ç­–ç•¥ï¼ŒéªŒè¯äº†vibe_surf_agentä¸browser_managerçš„ååŒå·¥ä½œï¼ŒåŒ…æ‹¬å¤šæ ‡ç­¾å¹¶è¡Œæ‰§è¡Œå’Œä»»åŠ¡è°ƒåº¦çš„æµ‹è¯•ã€‚æ–‡æ¡£è¿˜è¯¦ç»†è¯´æ˜äº†browser_use_agentåœ¨çœŸå®æµè§ˆå™¨ç¯å¢ƒä¸­æ‰§è¡Œæ“ä½œçš„æµ‹è¯•ç”¨ä¾‹ï¼Œä»¥åŠä»£ç†çŠ¶æ€ç®¡ç†å’Œå…±äº«çŠ¶æ€çš„æµ‹è¯•æ–¹æ³•ã€‚æ­¤å¤–ï¼Œæ–‡æ¡£æ¶µç›–äº†LLMäº¤äº’ã€å¼‚å¸¸å¤„ç†å’Œæ€§èƒ½æµ‹è¯•çš„å®Œæ•´æµ‹è¯•æ–¹æ¡ˆï¼Œä¸ºVibeSurfç³»ç»Ÿçš„ç¨³å®šæ€§å’Œå¯é æ€§æä¾›äº†æœ‰åŠ›ä¿éšœã€‚
# 组件架构

<cite>
**本文档中引用的文件**  
- [App.tsx](file://vibe_surf/frontend/src/App.tsx)
- [routes.tsx](file://vibe_surf/frontend/src/routes.tsx)
- [authGuard/index.tsx](file://vibe_surf/frontend/src/components/authorization/authGuard/index.tsx)
- [dialog.tsx](file://vibe_surf/frontend/src/components/ui/dialog.tsx)
- [baseModal/index.tsx](file://vibe_surf/frontend/src/modals/baseModal/index.tsx)
- [pageLayout/index.tsx](file://vibe_surf/frontend/src/components/common/pageLayout/index.tsx)
- [index.tsx](file://vibe_surf/frontend/src/CustomEdges/index.tsx)
- [GenericNode/components/NodeName/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeName/index.tsx)
- [GenericNode/components/NodeDescription/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeDescription/index.tsx)
- [GenericNode/components/NodeInputField/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeInputField/index.tsx)
- [GenericNode/components/NodeOutputParameter/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeOutputParameter/index.tsx)
- [GenericNode/components/handleRenderComponent/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/handleRenderComponent/index.tsx)
- [GenericNode/components/nodeIcon/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/nodeIcon/index.tsx)
- [GenericNode/components/RenderInputParameters/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/RenderInputParameters/index.tsx)
- [GenericNode/components/NodeStatus/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeStatus/index.tsx)
- [GenericNode/components/NodeDialogComponent/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeDialogComponent/index.tsx)
</cite>

## 目录
1. [项目结构](#项目结构)
2. [核心组件](#核心组件)
3. [组件目录职责划分](#组件目录职责划分)
4. [工作流可视化编辑器支持](#工作流可视化编辑器支持)
5. [模态框组件设计模式](#模态框组件设计模式)
6. [共享组件设计原则](#共享组件设计原则)
7. [组件层级关系图](#组件层级关系图)

## 项目结构

```mermaid
graph TD
A[前端入口 App.tsx] --> B[路由配置 routes.tsx]
B --> C[授权组件 authorization]
B --> D[通用组件 common]
B --> E[核心组件 core]
B --> F[UI组件 ui]
A --> G[自定义节点 CustomNodes]
A --> H[自定义边 CustomEdges]
A --> I[模态框 modals]
A --> J[共享组件 shared]
```

**图示来源**
- [App.tsx](file://vibe_surf/frontend/src/App.tsx)
- [routes.tsx](file://vibe_surf/frontend/src/routes.tsx)

## 核心组件

VibeSurf前端应用的核心组件构成了整个系统的骨架，包括应用入口、路由系统和上下文管理。App.tsx作为应用的根组件，负责初始化React应用并提供全局上下文。

**组件来源**
- [App.tsx](file://vibe_surf/frontend/src/App.tsx)
- [routes.tsx](file://vibe_surf/frontend/src/routes.tsx)

## 组件目录职责划分

### 授权组件 (authorization)

授权组件目录包含了一系列用于处理用户认证和权限控制的高阶组件。这些组件作为路由守卫，确保只有经过适当授权的用户才能访问特定页面。

```mermaid
classDiagram
class ProtectedRoute {
+isAuthenticated : boolean
+autoLogin : boolean
+shouldRedirect : boolean
+componentDidMount() : void
}
class ProtectedLoginRoute {
+isAuthenticated : boolean
+shouldRedirect : boolean
}
class ProtectedAdminRoute {
+isAdmin : boolean
+shouldRedirect : boolean
}
ProtectedRoute --> ProtectedLoginRoute : "继承"
ProtectedRoute --> ProtectedAdminRoute : "继承"
```

**组件来源**
- [authGuard/index.tsx](file://vibe_surf/frontend/src/components/authorization/authGuard/index.tsx)

### 通用组件 (common)

通用组件目录包含了跨应用使用的可复用UI组件，这些组件不依赖于特定业务逻辑，而是提供基础的UI功能。

```mermaid
flowchart TD
A[通用组件] --> B[布局组件]
A --> C[显示组件]
A --> D[交互组件]
B --> B1[pageLayout]
B --> B2[GradientWrapper]
C --> C1[ImageViewer]
C --> C2[stringReaderComponent]
D --> D1[dropdownComponent]
D --> D2[paginatorComponent]
D --> D3[loadingComponent]
```

**组件来源**
- [pageLayout/index.tsx](file://vibe_surf/frontend/src/components/common/pageLayout/index.tsx)

### 核心组件 (core)

核心组件目录包含了应用的关键功能组件，这些组件通常与特定业务场景紧密相关，如画布控制、卡片管理、参数渲染等。

### UI组件 (ui)

UI组件目录基于Radix UI和Tailwind CSS构建，提供了标准化的原子化UI组件，确保整个应用的视觉一致性。

```mermaid
classDiagram
class Button {
+variant : string
+size : string
+loading : boolean
+disabled : boolean
}
class Dialog {
+open : boolean
+onOpenChange : function
}
class Input {
+type : string
+placeholder : string
+disabled : boolean
}
class Card {
+className : string
}
Button <|-- Dialog : "组合"
Input <|-- Dialog : "组合"
Card <|-- Dialog : "组合"
```

**组件来源**
- [dialog.tsx](file://vibe_surf/frontend/src/components/ui/dialog.tsx)

## 工作流可视化编辑器支持

### 自定义节点 (CustomNodes)

自定义节点系统是工作流可视化编辑器的核心，每个节点代表一个可执行的操作或数据处理单元。

```mermaid
classDiagram
class GenericNode {
+data : object
+selected : boolean
+isConnected : boolean
+status : string
}
class NodeName {
+name : string
+editable : boolean
}
class NodeDescription {
+description : string
}
class NodeInputField {
+label : string
+type : string
+required : boolean
}
class NodeOutputParameter {
+outputs : array
}
class NodeStatus {
+status : string
+message : string
}
class NodeIcon {
+iconName : string
+color : string
}
class RenderInputParameters {
+parameters : array
+onParameterChange : function
}
GenericNode --> NodeName : "包含"
GenericNode --> NodeDescription : "包含"
GenericNode --> NodeInputField : "包含"
GenericNode --> NodeOutputParameter : "包含"
GenericNode --> NodeStatus : "包含"
GenericNode --> NodeIcon : "包含"
GenericNode --> RenderInputParameters : "包含"
```

**组件来源**
- [GenericNode/components/NodeName/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeName/index.tsx)
- [GenericNode/components/NodeDescription/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeDescription/index.tsx)
- [GenericNode/components/NodeInputField/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeInputField/index.tsx)
- [GenericNode/components/NodeOutputParameter/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeOutputParameter/index.tsx)
- [GenericNode/components/NodeStatus/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/NodeStatus/index.tsx)
- [GenericNode/components/nodeIcon/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/nodeIcon/index.tsx)
- [GenericNode/components/RenderInputParameters/index.tsx](file://vibe_surf/frontend/src/CustomNodes/GenericNode/components/RenderInputParameters/index.tsx)

### 自定义边 (CustomEdges)

自定义边组件负责在节点之间创建连接线，可视化数据流和控制流。

```mermaid
sequenceDiagram
participant NodeA as 节点A
participant Edge as 边组件
participant NodeB as 节点B
NodeA->>Edge : 提供源句柄(sourceHandleId)
NodeB->>Edge : 提供目标句柄(targetHandleId)
Edge->>Edge : 计算贝塞尔曲线路径
Edge->>Edge : 根据连接类型设置样式
Edge->>NodeA : 渲染连接线
Edge->>NodeB : 渲染连接线
```

**组件来源**
- [index.tsx](file://vibe_surf/frontend/src/CustomEdges/index.tsx)

## 模态框组件设计模式

### 基础模态框 (baseModal)

基础模态框组件采用复合组件模式，通过静态属性暴露子组件，提供灵活的配置选项。

```mermaid
classDiagram
class BaseModal {
+open : boolean
+setOpen : function
+size : string
+type : string
+onChangeOpenModal : function
}
class Content {
+children : ReactNode
+overflowHidden : boolean
}
class Header {
+children : ReactNode
+description : string
}
class Footer {
+submit : object
+close : boolean
}
class Trigger {
+children : ReactNode
+asChild : boolean
}
BaseModal --> Content : "包含"
BaseModal --> Header : "包含"
BaseModal --> Footer : "包含"
BaseModal --> Trigger : "包含"
BaseModal : Content = Content
BaseModal : Header = Header
BaseModal : Footer = Footer
BaseModal : Trigger = Trigger
```

**组件来源**
- [baseModal/index.tsx](file://vibe_surf/frontend/src/modals/baseModal/index.tsx)

### 模态框复用机制

模态框组件通过props传递和组合模式实现复用，不同业务场景的模态框可以继承基础模态框的功能。

```mermaid
flowchart TD
A[基础模态框] --> B[认证模态框]
A --> C[API模态框]
A --> D[确认模态框]
A --> E[文件管理模态框]
A --> F[流程设置模态框]
B --> B1[登录模态框]
B --> B2[注册模态框]
C --> C1[代码区域模态框]
C --> C2[字典区域模态框]
D --> D1[删除确认模态框]
D --> D2[保存更改模态框]
```

## 共享组件设计原则

共享组件目录包含了跨模块使用的通用功能组件和Hook，遵循单一职责原则和可组合性原则。

```mermaid
classDiagram
class GlobalVariableModal {
+variables : array
+onSave : function
+onDelete : function
}
class DeleteConfirmationModal {
+message : string
+onConfirm : function
+onCancel : function
}
class useAlternate {
+alternates : array
+currentIndex : number
+next() : void
+reset() : void
}
class useChangeOnUnfocus {
+value : any
+onChange : function
+onBlur : function
}
class useFileSizeValidator {
+maxSize : number
+validate(file) : boolean
+errorMessage : string
}
class useTabVisibility {
+isVisible : boolean
+onVisibilityChange : function
}
```

**组件来源**
- [shared/components/global-variable-modal.tsx](file://vibe_surf/frontend/src/shared/components/global-variable-modal.tsx)
- [shared/components/delete-confirmation-modal.tsx](file://vibe_surf/frontend/src/shared/components/delete-confirmation-modal.tsx)
- [shared/hooks/use-alternate.tsx](file://vibe_surf/frontend/src/shared/hooks/use-alternate.tsx)
- [shared/hooks/use-change-on-unfocus.tsx](file://vibe_surf/frontend/src/shared/hooks/use-change-on-unfocus.tsx)
- [shared/hooks/use-file-size-validator.ts](file://vibe_surf/frontend/src/shared/hooks/use-file-size-validator.ts)
- [shared/hooks/use-tab-visibility.ts](file://vibe_surf/frontend/src/shared/hooks/use-tab-visibility.ts)

## 组件层级关系图

```mermaid
graph TD
A[App] --> B[Router]
B --> C[Authorization Guard]
C --> D[Page Layout]
D --> E[Core Components]
D --> F[Custom Nodes]
D --> G[Custom Edges]
D --> H[Modals]
E --> I[Canvas Controls]
E --> J[Flow Toolbar]
E --> K[Parameter Render]
F --> L[Node Name]
F --> M[Node Description]
F --> N[Node Input]
F --> O[Node Output]
F --> P[Node Status]
H --> Q[Base Modal]
Q --> R[Modal Content]
Q --> S[Modal Header]
Q --> T[Modal Footer]
Q --> U[Modal Trigger]
```

**图示来源**
- [App.tsx](file://vibe_surf/frontend/src/App.tsx)
- [routes.tsx](file://vibe_surf/frontend/src/routes.tsx)
- [pageLayout/index.tsx](file://vibe_surf/frontend/src/components/common/pageLayout/index.tsx)
- [GenericNode](file://vibe_surf/frontend/src/CustomNodes/GenericNode)
- [baseModal/index.tsx](file://vibe_surf/frontend/src/modals/baseModal/index.tsx)
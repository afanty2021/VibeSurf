# 核心功能

<cite>
**本文档引用的文件**  
- [README.md](file://README.md)
- [main.py](file://vibe_surf/backend/main.py)
- [background.js](file://vibe_surf/chrome_extension/background.js)
- [vibesurf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py)
- [agent_browser_session.py](file://vibe_surf/browser/agent_browser_session.py)
- [shared_state.py](file://vibe_surf/backend/shared_state.py)
- [llm_config.py](file://vibe_surf/backend/llm_config.py)
- [content.js](file://vibe_surf/chrome_extension/content.js)
- [composio_client.py](file://vibe_surf/tools/composio_client.py)
</cite>

## 目录
1. [高级AI自动化功能](#高级ai自动化功能)
2. [多代理并行处理系统](#多代理并行处理系统)
3. [工作流引擎](#工作流引擎)
4. [Chrome扩展UI集成](#chrome扩展ui集成)
5. [本地LLM和自定义LLM API支持](#本地llm和自定义llm-api支持)
6. [第三方服务集成](#第三方服务集成)

## 高级AI自动化功能

VibeSurf的核心功能之一是其高级AI自动化能力，能够执行深度研究、智能爬取和内容摘要等复杂任务。系统通过LangGraph框架构建了一个基于状态机的工作流，将复杂的浏览器任务分解为多个可管理的步骤。VibeSurfAgent组件作为核心协调器，接收用户任务并将其分解为具体的行动步骤。

该系统实现了深度研究和智能爬取功能，通过BrowserUseAgent组件在独立的浏览器会话中并行执行多个任务。每个代理都配备了完整的工具集，包括网页导航、元素交互、内容提取等。内容摘要功能通过ReportWriterAgent实现，能够将收集到的信息组织成结构化的报告。

系统采用thinking + action模式，代理在执行每个动作前都会进行思考和规划。这种模式通过CustomAgentOutput类实现，该类结合了VibeSurfTools中注册的所有可用动作。代理的决策过程被详细记录在活动日志中，包括思考过程、评估结果和下一步目标。

**Section sources**
- [vibesurf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L344-L546)
- [README.md](file://README.md#L14-L15)

## 多代理并行处理系统

VibeSurf实现了强大的多代理并行处理系统，支持在不同浏览器标签页中同时运行多个AI代理。该系统基于AgentBrowserSession类构建，为每个代理提供隔离的浏览器会话环境。BrowserManager组件负责管理所有代理会话的生命周期，包括创建、注册和销毁。

系统支持两种执行模式：单任务执行和并行任务执行。对于单个任务，系统使用单一代理会话；对于多个任务，则创建多个并行代理。execute_parallel_browser_tasks函数实现了并行执行逻辑，它为每个任务创建独立的BrowserUseAgent实例，并通过asyncio.gather并发执行。

代理间的通信和协调通过共享状态机制实现。VibeSurfAgent维护一个_running_agents字典，跟踪所有正在运行的代理实例。这种设计允许主代理监控子代理的状态，并在需要时进行协调或终止。每个代理在独立的浏览器上下文中运行，确保任务间的隔离性和安全性。

**Section sources**
- [vibesurf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L548-L763)
- [agent_browser_session.py](file://vibe_surf/browser/agent_browser_session.py#L51-L123)

## 工作流引擎

VibeSurf的工作流引擎支持拖放式和对话式工作流的创建与执行。系统基于Langflow平台构建，提供了可视化的工作流编辑界面。用户可以通过拖放组件来构建复杂的工作流，每个组件代表一个特定的功能或操作。

工作流的执行由VibeSurfAgentComponent驱动，该组件作为Langflow的集成点。工作流中的每个节点都对应一个具体的动作，这些动作通过VibeSurfTools注册到系统中。用户可以通过对话界面与工作流交互，系统会根据上下文智能地选择和执行相应的动作。

工作流引擎支持条件分支、循环和错误处理等高级功能。通过组合不同的组件，用户可以创建复杂的自动化流程，如自动登录、数据收集和社交媒体发布。系统还支持工作流的保存和重用，提高了工作效率。

**Section sources**
- [vibesurf_agent.py](file://vibe_surf/agents/vibe_surf_agent.py#L24-L77)
- [README.md](file://README.md#L18-L19)

## Chrome扩展UI集成

VibeSurf通过Chrome扩展实现了无缝的UI集成，提供了侧边栏、弹出窗口和后台脚本的完整交互体系。扩展的UI主要由sidepanel.html和popup.html构成，通过content.js和background.js实现与网页内容的交互。

后台脚本(background.js)负责扩展的生命周期管理，包括安装、启动和消息处理。它监听浏览器动作按钮的点击事件，并在用户点击时打开侧边栏。扩展还实现了上下文菜单，为用户提供备用的访问方式。

内容脚本(content.js)注入到每个网页中，负责收集页面上下文、处理用户交互事件和与后台脚本通信。当用户开始录制工作流时，content.js会监听点击、输入和键盘事件，并将这些事件发送到后台脚本进行处理。系统还实现了麦克风权限请求的特殊处理机制，通过注入隐藏的iframe来解决权限问题。

**Section sources**
- [background.js](file://vibe_surf/chrome_extension/background.js#L10-L158)
- [content.js](file://vibe_surf/chrome_extension/content.js#L1-L745)

## 本地LLM和自定义LLM API支持

VibeSurf支持本地LLM和自定义LLM API，确保用户浏览数据的隐私和安全。系统通过llm_config.py文件定义了所有支持的LLM提供商及其模型，包括OpenAI、Anthropic、Google Gemini、Ollama等。

LLM配置管理通过shared_state.py中的update_llm_from_profile函数实现。用户可以在设置界面中创建和管理不同的LLM配置文件，每个配置文件包含模型名称、API端点、API密钥等信息。系统支持将Ollama等本地LLM作为后端，所有处理都在用户本地完成。

当用户选择不同的LLM配置文件时，系统会动态更新全局的LLM实例。create_llm_from_profile函数根据配置文件创建相应的LLM实例，并将其注册到token cost service中进行使用量跟踪。这种设计允许用户在不同场景下灵活切换LLM提供商。

**Section sources**
- [llm_config.py](file://vibe_surf/backend/llm_config.py#L1-L226)
- [shared_state.py](file://vibe_surf/backend/shared_state.py#L644-L682)

## 第三方服务集成

VibeSurf通过Composio实现了与Gmail、Notion、Slack等第三方服务的集成。composio_client.py文件定义了ComposioClient类，负责将Composio工具包中的工具注册为VibeSurf动作。

集成过程通过register_to_tools方法实现，该方法遍历所有启用的工具包，为每个工具创建相应的动作。系统使用Pydantic模型动态生成工具参数的类型定义，并创建异步包装函数来调用Composio工具。注册的动作以"cpo."为前缀，如"cpo.gmail.send_email"。

用户可以在设置界面中启用或禁用特定的工具包。系统会定期检查数据库中的工具包配置，并在配置发生变化时自动更新已注册的工具。这种设计确保了第三方服务集成的灵活性和可扩展性，用户可以轻松添加新的服务集成。

**Section sources**
- [composio_client.py](file://vibe_surf/tools/composio_client.py#L39-L319)
- [README.md](file://README.md#L143-L144)